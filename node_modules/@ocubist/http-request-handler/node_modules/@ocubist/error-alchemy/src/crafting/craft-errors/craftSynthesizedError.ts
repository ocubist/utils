import { v4 as uuid } from "uuid";

import { CraftErrorProps, CraftedErrorProps } from "./types";
import { SynthesizedError } from "../../transmuted-errors/SynthesizedError";

export const craftSynthesizedError = (props: CraftErrorProps) => {
  const craftProps = props;
  const dynamicUUID = uuid();

  class CraftedSynthesizedError extends SynthesizedError {
    dynamicClassUuid: string;
    constructor(props: CraftedErrorProps) {
      super({ ...craftProps, ...props });

      // Set the prototype explicitly.
      Object.setPrototypeOf(this, CraftedSynthesizedError.prototype);

      this.dynamicClassUuid = dynamicUUID;
    }

    static compare(err: unknown): boolean {
      return err instanceof CraftedSynthesizedError;
    }
  }

  return CraftedSynthesizedError;
};
