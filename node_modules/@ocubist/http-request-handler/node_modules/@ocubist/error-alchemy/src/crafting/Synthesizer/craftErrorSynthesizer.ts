import {
  executeSynthesizerMiddlewareOneByOne,
  flattenMiddlewareChain,
} from "./helpers";
import { Synthesizer, SynthesizerMiddlewareChain } from "./types";

export const craftErrorSynthesizer = (
  middlewareChain: SynthesizerMiddlewareChain
): Synthesizer => {
  const newSynthesizer: Synthesizer = {
    middlewareChain: flattenMiddlewareChain(middlewareChain),
    synthesize(err) {
      return executeSynthesizerMiddlewareOneByOne(err, this.middlewareChain);
    },
  };

  return newSynthesizer;
};
