import { v4 as uuid } from "uuid";
import { MysticError } from "../../transmuted-errors/MysticError";
import { CraftErrorProps, CraftedErrorProps } from "./types";

export const craftMysticError = (props: CraftErrorProps) => {
  const craftProps = props;
  const dynamicUUID = uuid();

  class CraftedMysticError extends MysticError {
    dynamicClassUuid: string;
    constructor(props: CraftedErrorProps) {
      super({ ...craftProps, ...props });

      // Set the prototype explicitly.
      Object.setPrototypeOf(this, CraftedMysticError.prototype);

      this.dynamicClassUuid = dynamicUUID;
    }

    static compare(err: unknown): boolean {
      return err instanceof CraftedMysticError;
    }
  }

  return CraftedMysticError;
};
